Master Setup Guide
==================

Last updated: UnitBrain transitions now perform parent-aware hierarchical OnExit/OnEnter lifecycle calls

FSM event flow semantics (authoritative):

FSM hierarchical transition lifecycle semantics:
- `UnitBrain` now computes full ancestry chains (`state`, `Parent`, ... root) for both current and target states.
- During transition, it finds the lowest common ancestor (LCA) between old and new chains.
- `OnExit` is called from the old leaf upward, excluding the LCA.
- `current` is then set to the transition target state.
- `OnEnter` is called from just below the LCA downward to the new leaf.
- This guarantees parent states (for example `WorkingState`) participate consistently when entering/exiting child states.

- `UnitBrain.EmitEvent(evt)` first offers events to current state and parent chain via `HandleEvent`.
- A state only blocks transition evaluation when it returns `true` from `HandleEvent`.
- Transition-driving events in worker leaf states are intentionally not consumed internally.
- Worker leaf states (`MoveToResourceState`, `GatheringState`, `MoveToDropoffState`, `DeliveringState`) now return `false` for `Arrived`, `WorkComplete`, and `DeliveryComplete` so transition assets can execute.

Verified worker transition chain:
- `Idle -> MoveToResource` on `OnOrderGather`
- `MoveToResource -> Gathering` on `Arrived`
- `Gathering -> MoveToDropoff` on `WorkComplete`
- `MoveToDropoff -> Delivering` on `Arrived`
- `Delivering -> Idle` on `DeliveryComplete`

Legacy validation architecture notes:
- Unity menu: `Tools/Validation/Validate All Definitions`
- Runtime bootstrap, editor menu validation, and CI use the same validation orchestration core.
- CI execute method: `DefinitionValidationMenu.ValidateAllForCI`.
